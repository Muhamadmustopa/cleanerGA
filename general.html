<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Cleaner</title>
<style>
body{
  font-family:Segoe UI,Arial;
  background:#f4f6f8;
  margin:0;padding:16px
}
.card{
  background:#fff;
  border-radius:16px;
  padding:20px;
  max-width:900px;
  margin:auto;
  box-shadow:0 6px 14px rgba(0,0,0,.1)
}
.header{
  display:flex;
  justify-content:space-between;
  align-items:center
}
select,input{
  padding:10px;
  border-radius:10px;
  border:1px solid #ccc;
  margin-top:6px
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:16px
}
th,td{
  border:1px solid #ddd;
  padding:10px;
  font-size:14px
}
th{background:#f0f0f0}
button{
  padding:12px 18px;
  border:none;
  border-radius:12px;
  font-size:14px;
  cursor:pointer
}
.save{background:#4CAF50;color:#fff}
.logout{background:#f44336;color:#fff}
.warn{color:#d32f2f;font-size:13px}
.date-warn{border:2px solid #d32f2f}
</style>
</head>
<body>

<div class="card">
  <div class="header">
    <div>
      <strong id="userName"></strong><br>
      <small>Daily Task Cleaner</small>
    </div>
    <button class="logout" onclick="logout()">Keluar</button>
  </div>

  <br>

  <!-- LOKASI -->
  <label>Lokasi Kerja</label><br>
  <select id="lokasi" onchange="renderTask()">
    <option value="">-- Pilih Lokasi --</option>
    <option value="MTHS">MTH Square (Head Office)</option>
    <option value="BIZPARK">Bizpark 3 (Warehouse)</option>
  </select>

  <br><br>

  <!-- TANGGAL -->
  <label>Tanggal</label><br>
  <input type="date" id="tanggal">
  <span id="warning" class="warn">Wajib Diisi</span>

  <!-- TASK -->
  <table>
    <thead>
      <tr>
        <th>Area</th>
        <th>List Pekerjaan</th>
        <th>Checklist Status</th>
        <th>Keterangan</th>
      </tr>
    </thead>
    <tbody id="taskBody"></tbody>
  </table>

  <br>
  <button class="save" onclick="simpan()">Simpan</button>
</div>

<script>
/* ====== PROTEKSI LOGIN ====== */
const role=localStorage.getItem('role');
const user=localStorage.getItem('cleaner_name');
if(role!=='cleaner'||!user) location.href='login.html';
document.getElementById('userName').innerText=user;

/* ====== TASK PER LOKASI ====== */
const taskByLocation={
  MTHS:[
    {area:'Area Kerja',task:'Sapu & Pel Lantai'},
    {area:'Area Kerja',task:'Vacum Karpet Lantai'},
    {area:'Area Kerja',task:'Lap Pintu Kaca'},
    {area:'Area Kerja',task:'Bersihkan meja,kursi lemari area kerja'},
    {area:'Area Kerja',task:'Lap Pintu Kaca'},
    {area:'Pantry',task:'Buang Sampah'},
    {area:'Koridor',task:'Pel Lantai'}
  ],
  BIZPARK:[
    {area:'Gudang',task:'Sapu Area Gudang'},
    {area:'Loading Dock',task:'Bersihkan Area'},
    {area:'Toilet',task:'Cek & Bersihkan'},
    {area:'Area Parkir',task:'Pungut Sampah'},
    {area:'Kantor Warehouse',task:'Lap Meja'}
  ]
};

const tbody=document.getElementById('taskBody');
const lokasiSelect=document.getElementById('lokasi');
const inputTanggal=document.getElementById('tanggal');
const warning=document.getElementById('warning');

/* ====== RENDER TASK ====== */
function renderTask(){
  const lokasi=lokasiSelect.value;
  tbody.innerHTML='';
  if(!lokasi) return;

  taskByLocation[lokasi].forEach(t=>{
    tbody.innerHTML+=`
    <tr>
      <td>${t.area}</td>
      <td>${t.task}</td>
      <td style="text-align:center">
        <input type="checkbox">
      </td>
      <td><input></td>
    </tr>`;
  });
  cek();
}

/* ====== TANGGAL ====== */
function setToday(){
  let d=new Date();
  while(d.getDay()==0||d.getDay()==6){
    d.setDate(d.getDate()+1);
  }
  inputTanggal.valueAsDate=d;
  cek();
}

function cek(){
  const lokasi=lokasiSelect.value;
  if(!lokasi||!inputTanggal.value) return;

  const key=user+'_'+lokasi+'_'+inputTanggal.value;
  const data=JSON.parse(localStorage.getItem('filled')||'{}');

  if(!data[key]){
    warning.style.display='inline';
    inputTanggal.classList.add('date-warn');
  }else{
    warning.style.display='none';
    inputTanggal.classList.remove('date-warn');
  }
}

/* ====== SIMPAN ====== */
function simpan(){
  const lokasi=lokasiSelect.value;
  if(!lokasi){
    alert('Pilih lokasi terlebih dahulu');
    return;
  }

  const key=user+'_'+lokasi+'_'+inputTanggal.value;
  const data=JSON.parse(localStorage.getItem('filled')||'{}');
  data[key]=true;
  localStorage.setItem('filled',JSON.stringify(data));

  alert('Checklist tersimpan');
  cek();
}

/* ====== EVENT ====== */
inputTanggal.onchange=()=>{
  const d=new Date(inputTanggal.value);
  if(d.getDay()==0||d.getDay()==6){
    alert('Sabtu & Minggu tidak termasuk');
    setToday();
  }
  cek();
};

function logout(){
  localStorage.clear();
  location.href='login.html';
}

setToday();
</script>

</body>
</html>
