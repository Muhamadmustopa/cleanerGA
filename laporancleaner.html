<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Report Data</title>

<style>
body{
  font-family: Arial, sans-serif;
  margin:20px;
}

h2{
  margin-bottom:10px;
}

.filter-box{
  display:flex;
  gap:10px;
  margin-bottom:15px;
  flex-wrap:wrap;
}

input, select{
  padding:6px;
}

button{
  padding:6px 12px;
  border:none;
  border-radius:4px;
  cursor:pointer;
}

.btn-back{
  background:#1a73e8;
  color:white;
}

.table-wrap{
  border:1px solid #ddd;
  overflow-y:auto;
  max-height:480px; /* kira-kira 12 baris */
}

table{
  border-collapse:collapse;
  width:100%;
}

th, td{
  border:1px solid #ddd;
  padding:8px;
  text-align:left;
}

thead th{
  position:sticky;
  top:0;
  background:#f1f3f4;
  z-index:2;
}
</style>
</head>

<body>

<h2>Report Data</h2>

<div class="filter-box">
  <input type="date" id="dateFrom">
  <input type="date" id="dateTo">
  <select id="filterNama"></select>
  <select id="filterLokasi"></select>
  <input type="text" id="search" placeholder="Search area/task">
  <button class="btn-back" onclick="window.location.href='report.html'">Kembali</button>
</div>

<div class="table-wrap">
  <table>
    <thead>
      <tr>
        <th>Timestamp</th>
        <th>Nama</th>
        <th>Lokasi</th>
        <th>Tanggal</th>
        <th>Area</th>
        <th>Task</th>
        <th>Status</th>
        <th>Keterangan</th>
        <th>Komentar</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

<script>

const API_URL = "PASTE_URL_WEBAPP_KAMU_DISINI";

let rawData = [];

const dateFrom = document.getElementById("dateFrom");
const dateTo   = document.getElementById("dateTo");
const filterNama = document.getElementById("filterNama");
const filterLokasi = document.getElementById("filterLokasi");
const search = document.getElementById("search");
const tableBody = document.getElementById("tableBody");

function formatDate(dateString){
  const d = new Date(dateString);
  if(isNaN(d)) return dateString;

  const day = String(d.getDate()).padStart(2,'0');
  const month = String(d.getMonth()+1).padStart(2,'0');
  const year = d.getFullYear();

  return `${day}-${month}-${year}`;
}

function render(){

  const data = rawData.filter(r=>{

    const rowDate = new Date(r[3]);

    if(dateFrom.value){
      if(rowDate < new Date(dateFrom.value)) return false;
    }

    if(dateTo.value){
      if(rowDate > new Date(dateTo.value)) return false;
    }

    if(filterNama.value && r[1]!==filterNama.value) return false;
    if(filterLokasi.value && r[2]!==filterLokasi.value) return false;

    if(search.value && !(r[4]+r[5]).toLowerCase().includes(search.value.toLowerCase()))
      return false;

    return true;
  });

  tableBody.innerHTML = "";

  data.forEach(r=>{
    const row = `
      <tr>
        <td>${formatDate(r[0])}</td>
        <td>${r[1]}</td>
        <td>${r[2]}</td>
        <td>${formatDate(r[3])}</td>
        <td>${r[4]}</td>
        <td>${r[5]}</td>
        <td>${r[6]}</td>
        <td>${r[7]}</td>
        <td>${r[8]}</td>
      </tr>
    `;
    tableBody.innerHTML += row;
  });
}

function loadData(){
  fetch(API_URL)
  .then(res=>res.json())
  .then(data=>{
    rawData = data;

    const namaSet = new Set();
    const lokasiSet = new Set();

    rawData.forEach(r=>{
      namaSet.add(r[1]);
      lokasiSet.add(r[2]);
    });

    filterNama.innerHTML = "<option value=''>Semua Nama</option>";
    filterLokasi.innerHTML = "<option value=''>Semua Lokasi</option>";

    namaSet.forEach(n=>{
      filterNama.innerHTML += `<option value="${n}">${n}</option>`;
    });

    lokasiSet.forEach(l=>{
      filterLokasi.innerHTML += `<option value="${l}">${l}</option>`;
    });

    render();
  });
}

[dateFrom,dateTo,filterNama,filterLokasi,search]
.forEach(el=>el.onchange=render);

search.onkeyup = render;

loadData();

</script>

</body>
</html>
