<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checklist Driver Daily</title>

<style>
:root{
  --primary:#1976d2;
  --success:#4CAF50;
  --danger:#f44336;
  --border:#e0e0e0;
}
*{box-sizing:border-box}
body{
  margin:0;padding:14px;
  font-family:Segoe UI,Arial;
  background:linear-gradient(180deg,#e3f2fd,#f4f6f8);
}
.card{
  max-width:900px;margin:auto;
  background:#fff;border-radius:18px;
  padding:16px;
  box-shadow:0 8px 20px rgba(0,0,0,.12);
}
.hidden{display:none}
.section{
  border:1px solid var(--border);
  border-radius:16px;
  padding:14px;margin-top:14px;
}
button{
  padding:12px;border:none;border-radius:12px;
}
.save{background:var(--success);color:#fff;width:100%;margin-top:16px}
.item{display:flex;gap:10px}
.item.active{background:#e3f2fd}
</style>
</head>

<body>

<div class="card">
  <strong>Checklist Driver Daily</strong><br><br>

  <label>Nama Driver</label>
  <select id="driver">
    <option value="">-- Pilih --</option>
    <option>Ahmad Yani</option>
    <option>Sandi Suhendra</option>
  </select><br><br>

  <label>Tanggal</label>
  <input type="date" id="tanggal">

  <div id="taskArea" class="hidden">

    <div class="section">
      <h4>üöó Perjalanan</h4>
      <div id="tripList"></div>
      <button onclick="addTrip()">+ Tambah Tujuan</button>
    </div>

    <div class="section">
      <h4>üîß Kendaraan</h4>
      <label class="item"><input type="checkbox" data-k="Cuci Mobil">Cuci Mobil</label>
      <label class="item"><input type="checkbox" data-k="Panaskan Mesin">Panaskan Mesin</label>
      <textarea id="noteK" placeholder="Catatan kendaraan"></textarea>
    </div>

    <button class="save" onclick="simpan()">Simpan</button>
  </div>
</div>

<script>
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzgajiNxIg_NbBBWyMv9Cxa7kew_RSgcRV3cmg4PgWdXgXZpu2Os9Eyfq4pM-Us8_Bp/exec';

const driver = document.getElementById('driver');
const tanggal = document.getElementById('tanggal');
const taskArea = document.getElementById('taskArea');
const tripList = document.getElementById('tripList');
const noteK = document.getElementById('noteK');

tanggal.valueAsDate = new Date();

driver.addEventListener('change',()=>{
  taskArea.classList.toggle('hidden',!driver.value);
});

function addTrip(){
  const d=document.createElement('div');
  d.innerHTML=`<input placeholder="Tujuan"><input placeholder="Jam">`;
  tripList.appendChild(d);
}

async function cekDuplikat(){
  const url = `${SCRIPT_URL}?action=check&driver=${driver.value}&tanggal=${tanggal.value}`;
  const r = await fetch(url);
  const j = await r.json();
  return j.exists;
}

async function simpan(){
  if(await cekDuplikat()){
    alert('‚ùå Data sudah ada');
    return;
  }

  const payload=[];

  document.querySelectorAll('#tripList div').forEach(r=>{
    if(r.children[0].value){
      payload.push({
        driver:driver.value,
        tanggal:tanggal.value,
        kategori:'PERJALANAN',
        detail:`${r.children[0].value} ${r.children[1].value}`,
        status:'SELESAI',
        catatan:''
      });
    }
  });

  document.querySelectorAll('[data-k]').forEach(c=>{
    payload.push({
      driver:driver.value,
      tanggal:tanggal.value,
      kategori:'KENDARAAN',
      detail:c.dataset.k,
      status:c.checked?'OK':'TIDAK',
      catatan:noteK.value
    });
  });

  const res = await fetch(SCRIPT_URL,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(payload)
  }).then(r=>r.json());

  if(res.status==='SUCCESS'){
    alert('‚úÖ Tersimpan');
    location.reload();
  }else{
    alert('‚ùå Gagal');
  }
}
</script>

</body>
</html>
