<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checklist Driver Daily</title>

<style>
:root{
  --primary:#1976d2;
  --success:#4CAF50;
  --danger:#f44336;
  --border:#e0e0e0;
}

*{box-sizing:border-box}

body{
  margin:0;
  padding:16px;
  font-family:Segoe UI,Arial;
  background:linear-gradient(180deg,#e3f2fd,#f4f6f8);
}

.card{
  max-width:900px;
  margin:auto;
  background:#fff;
  border-radius:18px;
  padding:18px;
  box-shadow:0 8px 20px rgba(0,0,0,.12);
}

.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
}

.logout{
  background:var(--danger);
  color:#fff;
  border:none;
  padding:10px 14px;
  border-radius:12px;
  cursor:pointer;
}

label{font-size:14px;font-weight:600}

input,select,textarea{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid #ccc;
  margin-top:6px;
}

.section{
  border:1px solid var(--border);
  border-radius:16px;
  padding:14px;
  margin-top:16px;
}

.section h4{
  margin:0 0 12px;
  color:var(--primary)
}

/* GRID */
.grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px;
}
@media(max-width:600px){
  .grid{grid-template-columns:1fr}
}

.item{
  display:flex;
  align-items:flex-start;
  gap:10px;
  padding:12px;
  border:1px solid var(--border);
  border-radius:12px;
  cursor:pointer;
}

.item input{
  margin-top:3px;
  accent-color:var(--primary);
}

.item.active{
  background:#e3f2fd;
  border-color:var(--primary);
}

.trip{
  display:grid;
  grid-template-columns:1fr 120px;
  gap:8px;
  margin-bottom:8px;
}
@media(max-width:480px){
  .trip{grid-template-columns:1fr}
}

.add{
  width:100%;
  padding:12px;
  background:#e3f2fd;
  border:1px dashed var(--primary);
  border-radius:12px;
}

.save{
  width:100%;
  margin-top:20px;
  padding:14px;
  border:none;
  border-radius:16px;
  background:var(--success);
  color:#fff;
  font-size:16px;
  cursor:pointer;
}

.hidden{display:none}
</style>
</head>

<body>

<div class="card">

  <div class="header">
    <div>
      <strong>Checklist Driver Daily</strong><br>
      <small>Pencatatan Tugas Harian</small>
    </div>
    <button class="logout" onclick="logout()">Keluar</button>
  </div>

  <label>Nama Driver</label>
  <select id="driver">
    <option value="">-- Pilih Driver --</option>
    <option>Ahmad Yani</option>
    <option>Sandi Suhendra</option>
  </select>

  <br><br>

  <label>Tanggal</label>
  <input type="date" id="tanggal">

  <div id="taskArea" class="hidden">

    <div class="section">
      <h4>üöó Pengantaran</h4>
      <div id="tripList"></div>
      <button class="add" onclick="addTrip()">+ Tambah Tujuan</button>
    </div>

    <div class="section">
      <h4>üîß Perawatan Kendaraan</h4>
      <div class="grid">
        <label class="item"><input type="checkbox" data-kendaraan="Cuci Mobil">Cuci Mobil</label>
        <label class="item"><input type="checkbox" data-kendaraan="Panaskan Mesin">Panaskan Mesin</label>
        <label class="item"><input type="checkbox" data-kendaraan="Checklist Mobil">Checklist Mobil</label>
        <label class="item"><input type="checkbox" data-kendaraan="Lampu & Ban">Lampu & Ban</label>
        <label class="item"><input type="checkbox" data-kendaraan="BBM & KM">BBM & KM</label>
      </div>
      <textarea id="noteKendaraan" placeholder="Catatan kendaraan"></textarea>
    </div>

    <div class="section">
      <h4>üì¶ Tugas Lainnya</h4>
      <div class="grid">
        <label class="item"><input type="checkbox" data-tugas="Angkut Barang">Angkut Barang</label>
        <label class="item"><input type="checkbox" data-tugas="Frontliner">Frontliner</label>
        <label class="item"><input type="checkbox" data-tugas="Lainnya">Tugas Lain</label>
      </div>
      <textarea id="noteTugas" placeholder="Catatan tugas lain"></textarea>
    </div>

    <button class="save" onclick="simpan()">Simpan</button>
  </div>
</div>

<script>
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzgajiNxIg_NbBBWyMv9Cxa7kew_RSgcRV3cmg4PgWdXgXZpu2Os9Eyfq4pM-Us8_Bp/exec';

const elDriver=document.getElementById('driver');
const elTanggal=document.getElementById('tanggal');
const taskArea=document.getElementById('taskArea');
const tripList=document.getElementById('tripList');
const noteKend=document.getElementById('noteKendaraan');
const noteTugas=document.getElementById('noteTugas');

elTanggal.valueAsDate=new Date();

/* SESSION */
const saved=localStorage.getItem('driver_name');
if(saved){elDriver.value=saved;taskArea.classList.remove('hidden');}

elDriver.onchange=()=>{
  if(elDriver.value){
    localStorage.setItem('driver_name',elDriver.value);
    taskArea.classList.remove('hidden');
  }else{
    taskArea.classList.add('hidden');
  }
};

/* CHECKBOX UI */
document.addEventListener('change',e=>{
  if(e.target.matches('.item input')){
    e.target.parentElement.classList.toggle('active',e.target.checked);
  }
});

/* TRIP */
function addTrip(){
  const d=document.createElement('div');
  d.className='trip';
  d.innerHTML='<input placeholder="Tujuan"><input placeholder="Jam">';
  tripList.appendChild(d);
}

/* CEK DUPLIKAT */
async function cekDuplikat(){
  const url=`${SCRIPT_URL}?driver=${encodeURIComponent(elDriver.value)}&tanggal=${elTanggal.value}`;
  const r=await fetch(url);
  const j=await r.json();
  return j.exists===true;
}

/* SIMPAN */
async function simpan(){
  if(!elDriver.value){alert('Pilih driver');return;}

  if(await cekDuplikat()){
    alert('‚ùå Data tanggal ini sudah diisi');
    return;
  }

  const payload=[];

  document.querySelectorAll('#tripList .trip').forEach(r=>{
    if(r.children[0].value){
      payload.push({
        driver:elDriver.value,
        tanggal:elTanggal.value,
        kategori:'PERJALANAN',
        detail:r.children[0].value+' '+r.children[1].value,
        status:'SELESAI',
        catatan:''
      });
    }
  });

  document.querySelectorAll('[data-kendaraan]').forEach(c=>{
    payload.push({
      driver:elDriver.value,
      tanggal:elTanggal.value,
      kategori:'KENDARAAN',
      detail:c.dataset.kendaraan,
      status:c.checked?'OK':'TIDAK',
      catatan:noteKend.value
    });
  });

  document.querySelectorAll('[data-tugas]:checked').forEach(c=>{
    payload.push({
      driver:elDriver.value,
      tanggal:elTanggal.value,
      kategori:'TUGAS_LAIN',
      detail:c.dataset.tugas,
      status:'SELESAI',
      catatan:noteTugas.value
    });
  });

  const res=await fetch(SCRIPT_URL,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(payload)
  }).then(r=>r.json());

  if(res.status==='SUCCESS'){
    alert('‚úÖ Data berhasil masuk GSheet');
    location.reload();
  }else{
    alert('‚ùå Gagal menyimpan');
  }
}

function logout(){
  localStorage.removeItem('driver_name');
  location.href='login.html';
}
</script>

</body>
</html>
