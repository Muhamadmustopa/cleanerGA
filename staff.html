<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Checklist Pending</title>

<style>
body{
  font-family:Segoe UI;
  background:#f4f6f8;
  padding:20px;
}
h2{margin-top:0}
input, select, textarea, button{
  padding:8px;
  margin:6px 0;
  width:100%;
}
.section{
  background:#fff;
  padding:12px;
  border-radius:6px;
  margin-top:12px;
  display:none;
}
label{display:block;margin:4px 0}
button{
  background:#2563eb;
  color:#fff;
  border:none;
  border-radius:4px;
  cursor:pointer;
}
button:hover{opacity:.9}
</style>

</head>
<body>

<h2>Checklist Pending Harian</h2>

<!-- ================= PILIH STAFF ================= -->
<label>Nama Staff</label>
<select id="staff" onchange="onStaffChange()">
  <option value="">-- Pilih Staff --</option>
  <option>Muhamad Mustopa - Staff GA</option>
  <option>Abdul Apso - Staff Services</option>
</select>

<!-- ================= FORM TASK ================= -->
<div id="taskSection" class="section">

  <label>Tanggal</label>
  <input type="date" id="tanggal">

  <h3>✅ Pending Sebelumnya (Centang = Clear)</h3>
  <div id="pendingList">Tidak ada pending</div>

  <h3>➕ Tambah Pending Baru</h3>
  <textarea id="newPending" rows="4"
    placeholder="Satu task per baris"></textarea>

  <button onclick="submitData()">Submit Laporan</button>

</div>

<script>
const WEB_APP_URL = 'PASTE_URL_WEB_APP_KAMU';

let pendingTasks = [];

/* =====================
   STAFF DIPILIH
   ===================== */
function onStaffChange(){
  const staff = staffEl().value;
  const section = document.getElementById('taskSection');

  if(!staff){
    section.style.display = 'none';
    return;
  }

  section.style.display = 'block';
  loadPending();
}

/* =====================
   LOAD PENDING
   ===================== */
function loadPending(){
  const staff = staffEl().value;
  document.getElementById('pendingList').innerHTML = 'Loading...';

  fetch(`${WEB_APP_URL}?staff=${encodeURIComponent(staff)}`)
    .then(r=>r.json())
    .then(d=>{
      pendingTasks = d.pending || [];
      renderPending();
    });
}

/* =====================
   RENDER PENDING
   ===================== */
function renderPending(){
  const div = document.getElementById('pendingList');
  div.innerHTML = '';

  if(pendingTasks.length === 0){
    div.innerHTML = '<i>Tidak ada pending</i>';
    return;
  }

  pendingTasks.forEach(t=>{
    const l = document.createElement('label');
    l.innerHTML = `<input type="checkbox" value="${t}"> ${t}`;
    div.appendChild(l);
  });
}

/* =====================
   SUBMIT
   ===================== */
function submitData(){
  const staff = staffEl().value;
  const tanggal = dateEl().value;

  if(!tanggal){
    alert('Tanggal wajib diisi');
    return;
  }

  const clear = [...document.querySelectorAll('#pendingList input:checked')]
    .map(c=>c.value);

  const pending = document.getElementById('newPending')
    .value.split('\n').filter(Boolean);

  fetch(WEB_APP_URL,{
    method:'POST',
    body:JSON.stringify({staff,tanggal,clear,pending})
  })
  .then(r=>r.json())
  .then(res=>{
    alert(res.message || 'Berhasil disimpan');
    document.getElementById('newPending').value = '';
    loadPending();
  });
}

/* =====================
   HELPER
   ===================== */
const staffEl = ()=>document.getElementById('staff');
const dateEl = ()=>document.getElementById('tanggal');
</script>

</body>
</html>
