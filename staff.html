<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checklist Pending</title>

<style>
*{box-sizing:border-box}
body{
  font-family:Segoe UI,Arial;
  background:#f4f6f8;
  margin:0;
  padding:16px;
}

.card{
  max-width:500px;
  margin:auto;
  background:#fff;
  padding:16px;
  border-radius:14px;
  box-shadow:0 6px 16px rgba(0,0,0,.12);
}

h2{text-align:center;margin-top:0}

select,input,textarea,button{
  width:100%;
  padding:10px;
  margin-top:8px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:14px;
}

button{
  background:#2563eb;
  color:#fff;
  border:none;
  font-weight:600;
  cursor:pointer;
}
button:hover{opacity:.9}

.section{display:none;margin-top:16px}

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  margin-top:10px;
}

.box{
  background:#fafafa;
  border-radius:10px;
  padding:10px;
  border:1px solid #eee;
  max-height:300px;
  overflow:auto;
}

.box h4{
  margin:0 0 8px 0;
  font-size:14px;
}

.task{
  background:#fff;
  padding:6px 8px;
  border-radius:6px;
  margin-bottom:6px;
  font-size:13px;
  border:1px solid #eee;
}

.pending{border-left:4px solid #f59e0b}
.clear{border-left:4px solid #22c55e}

@media(max-width:600px){
  .grid{grid-template-columns:1fr}
}
</style>
</head>
<body>

<div class="card">
<h2>üìã Checklist Harian</h2>

<label>Nama Staff</label>
<select id="staff" onchange="initApp()">
  <option value="">-- Pilih Staff --</option>
  <option>Muhamad Mustopa - Staff GA</option>
  <option>Abdul Apso - Staff Services</option>
</select>

<div id="mainSection" class="section">

<label>Tanggal</label>
<input type="date" id="tanggal">

<div class="grid">

  <!-- TASK CLEAR -->
  <div class="box">
    <h4>‚úÖ Task Clear (8)</h4>
    <div id="clearList"></div>
  </div>

  <!-- TASK PENDING -->
  <div class="box">
    <h4>‚è≥ Task Pending (5)</h4>
    <div id="pendingList"></div>
  </div>

</div>

<h4 style="margin-top:14px">‚ûï Tambah Task Pending Baru</h4>
<textarea id="newPending" rows="3"
placeholder="Satu task per baris"></textarea>

<button onclick="submitData()">Simpan</button>

</div>
</div>

<script>
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwwWZxjV21Cd_3GGE7ODbopbCGriMhKH0FOdFdIwX737tDzxfATQMsIQwY-1-6FIIlqVA/exec';

let clearTasks = [];
let pendingTasks = [];

function initApp(){
  const staff = staffEl().value;
  if(!staff){
    mainEl().style.display='none';
    return;
  }

  mainEl().style.display='block';

  if(!dateEl().value){
    dateEl().value = new Date().toISOString().split('T')[0];
  }

  loadData();
}

/* ================= LOAD ================= */
function loadData(){
  const staff = staffEl().value;

  fetch(`${WEB_APP_URL}?staff=${encodeURIComponent(staff)}`)
  .then(r=>r.json())
  .then(d=>{
    clearTasks = d.clear || [];
    pendingTasks = d.pending || [];
    render();
  });
}

/* ================= RENDER ================= */
function render(){

  const clearDiv = document.getElementById('clearList');
  const pendingDiv = document.getElementById('pendingList');

  clearDiv.innerHTML='';
  pendingDiv.innerHTML='';

  // tampil max 8 clear
  clearTasks.slice(0,8).forEach(t=>{
    clearDiv.innerHTML+=`
      <div class="task clear">${t}</div>
    `;
  });

  // tampil max 5 pending
  pendingTasks.slice(0,5).forEach(t=>{
    pendingDiv.innerHTML+=`
      <div class="task pending">
        <label>
          <input type="checkbox"
            onchange="moveToClear('${encodeURIComponent(t)}')">
          ${t}
        </label>
      </div>
    `;
  });

}

/* ================= PINDAH PENDING ‚Üí CLEAR ================= */
function moveToClear(taskEncoded){
  const task = decodeURIComponent(taskEncoded);

  pendingTasks = pendingTasks.filter(t=>t!==task);
  clearTasks.push(task);

  render();
}

/* ================= SUBMIT ================= */
function submitData(){

  const staff = staffEl().value;
  const tanggal = dateEl().value;

  if(!tanggal){
    alert('Tanggal wajib diisi');
    return;
  }

  const newPending = document.getElementById('newPending')
    .value.split('\n')
    .filter(Boolean);

  pendingTasks = [...pendingTasks, ...newPending];

  fetch(WEB_APP_URL,{
    method:'POST',
    body:JSON.stringify({
      staff,
      tanggal,
      clear:clearTasks,
      pending:pendingTasks
    })
  })
  .then(r=>r.json())
  .then(res=>{
    alert(res.message || 'Data disimpan');
    document.getElementById('newPending').value='';
    loadData();
  });

}

/* ================= HELPER ================= */
const staffEl=()=>document.getElementById('staff');
const dateEl=()=>document.getElementById('tanggal');
const mainEl=()=>document.getElementById('mainSection');

</script>
</body>
</html>
