<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checklist Harian</title>

<style>
body{
  margin:0;
  font-family:Segoe UI;
  background:#f1f5f9;
  padding:15px;
}

.card{
  background:#fff;
  padding:16px;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
  max-width:500px;
  margin:auto;
}

h2{
  text-align:center;
  margin-top:0;
}

label{
  font-weight:600;
  margin-top:10px;
  display:block;
}

select,input,textarea,button{
  width:100%;
  padding:10px;
  margin-top:6px;
  border-radius:8px;
  border:1px solid #d1d5db;
  font-size:14px;
}

button{
  background:#2563eb;
  color:#fff;
  border:none;
  margin-top:15px;
  font-weight:600;
}

button:hover{
  opacity:.9;
}

.section{
  margin-top:15px;
  display:none;
}

.container-box{
  background:#f8fafc;
  padding:12px;
  border-radius:8px;
  margin-top:10px;
}

.task-input{
  margin-bottom:6px;
}
</style>
</head>
<body>

<div class="card">

<h2>üìã Report Daily </h2>

<label>Nama</label>
<select id="staff" onchange="handleStaff()">
  <option value="">-- Pilih Nama --</option>
  <option value="Muhamad Mustopa - Staff GA">
    Muhamad Mustopa - Staff GA
  </option>
  <option value="Abdul Apso - Staff Services">
    Abdul Apso - Staff Services
  </option>
</select>

<!-- SECTION TASK (Hidden Awal) -->
<div id="taskSection" class="section">

<label>Tanggal</label>
<input type="date" id="tanggal">

<!-- TASK CLEAR -->
<div class="container-box">
  <h3>‚úÖ Task Clear</h3>
  <div id="clearList"></div>
  <button type="button" onclick="addClear()">+Add Task</button>
</div>

<!-- TASK PENDING -->
<div class="container-box">
  <h3>‚è≥ Task Pending</h3>
  <div id="pendingList"></div>
  <button type="button" onclick="addPending()">+Add Task</button>
</div>

<button onclick="submitData()">Simpan</button>

</div>

</div>

<script>

const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwwWZxjV21Cd_3GGE7ODbopbCGriMhKH0FOdFdIwX737tDzxfATQMsIQwY-1-6FIIlqVA/exec";

let clearCount = 0;
let pendingCount = 0;

function handleStaff(){
  const staff = document.getElementById("staff").value;
  const section = document.getElementById("taskSection");

  if(staff){
    section.style.display="block";
    loadData();
  }else{
    section.style.display="none";
  }
}

function loadData(){
  const staff = document.getElementById("staff").value;

  fetch(`${WEB_APP_URL}?staff=${encodeURIComponent(staff)}`)
  .then(res=>res.json())
  .then(data=>{

    document.getElementById("clearList").innerHTML="";
    document.getElementById("pendingList").innerHTML="";

    clearCount = 0;
    pendingCount = 0;

    // TAMPIL CLEAR (MAX 8)
    data.clear.forEach(task=>{
      addClear(task);
    });

    // TAMPIL PENDING (MAX 5)
    data.pending.forEach(task=>{
      addPending(task);
    });

  });
}

/* ADD CLEAR */
function addClear(value=""){
  if(clearCount >= 20) return alert("Max 20 baris");

  clearCount++;

  const div = document.createElement("div");
  div.className="task-input";
  div.innerHTML = `
    <input type="text" value="${value}" placeholder="Isi task clear">
  `;
  document.getElementById("clearList").appendChild(div);
}

/* ADD PENDING */
function addPending(value=""){
  if(pendingCount >= 20) return alert("Max 20 baris");

  pendingCount++;

  const div = document.createElement("div");
  div.className="task-input";
  div.innerHTML = `
    <input type="text" value="${value}" placeholder="Isi task pending">
  `;
  document.getElementById("pendingList").appendChild(div);
}

function submitData(){

  const staff = document.getElementById("staff").value;
  const tanggal = document.getElementById("tanggal").value;

  if(!staff) return alert("Pilih nama staff dulu");
  if(!tanggal) return alert("Isi tanggal dulu");

  const clear = [...document.querySelectorAll("#clearList input")]
                .map(i=>i.value).filter(Boolean);

  const pending = [...document.querySelectorAll("#pendingList input")]
                .map(i=>i.value).filter(Boolean);

  fetch(WEB_APP_URL,{
    method:"POST",
    body:JSON.stringify({staff,tanggal,clear,pending})
  })
  .then(res=>res.json())
  .then(res=>{
    alert(res.message || "Berhasil disimpan");
    loadData();
  });

}

</script>
</body>
</html>
