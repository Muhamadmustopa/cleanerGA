<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Laporan Task</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
  margin:0;
  font-family:Segoe UI;
  background:#f1f5f9;
}

/* HEADER */
.header{
  background:#2563eb;
  color:white;
  padding:15px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.header h2{
  margin:0;
}

.header-right{
  display:flex;
  gap:15px;
  align-items:center;
}

.icon-btn{
  cursor:pointer;
  font-size:20px;
  position:relative;
}

.badge-notif{
  position:absolute;
  top:-6px;
  right:-8px;
  background:red;
  color:white;
  font-size:10px;
  padding:2px 6px;
  border-radius:50%;
}

.logout-btn{
  background:white;
  color:#2563eb;
  padding:6px 12px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}

/* FILTER SECTION */
.filter-box{
  background:white;
  padding:15px;
  margin:15px;
  border-radius:10px;
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  align-items:center;
  box-shadow:0 4px 10px rgba(0,0,0,0.05);
}

input, select{
  padding:6px;
  border:1px solid #ccc;
  border-radius:6px;
}

button{
  padding:6px 12px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  background:#2563eb;
  color:white;
}

/* SUMMARY */
.summary{
  display:flex;
  gap:15px;
  margin:15px;
  flex-wrap:wrap;
}

.box{
  flex:1;
  min-width:200px;
  padding:15px;
  border-radius:10px;
  color:white;
}

.box-blue{
  background:#2563eb;
}

.box-green{
  background:#16a34a;
}

/* TABLE */
.table-container{
  background:white;
  margin:15px;
  padding:15px;
  border-radius:10px;
  box-shadow:0 6px 15px rgba(0,0,0,0.08);
  overflow-x:auto;
}

table{
  width:100%;
  border-collapse:collapse;
}

thead{
  background:#2563eb;
  color:white;
}

th, td{
  padding:10px;
  border:1px solid #ddd;
  text-align:left;
}

tbody tr:nth-child(even){
  background:#f9fafb;
}

tbody tr:hover{
  background:#e0f2fe;
  transition:0.2s;
}

th{
  cursor:pointer;
}

@media(max-width:768px){
  .summary{
    flex-direction:column;
  }
}
</style>
</head>

<body>

<div class="header">
  <h2>Dashboard Timesheet Task Team General Affair</h2>
  <div class="header-right">
    <div class="icon-btn" onclick="checkNotFilled()">
      ðŸ””
      <span id="notifCount" class="badge-notif" style="display:none">0</span>
    </div>
    <button class="logout-btn" onclick="logout()">Kembali</button>
  </div>
</div>

<!-- FILTER -->
<div class="filter-box">
  Dari: <input type="date" id="fromDate">
  Sampai: <input type="date" id="toDate">

  User:
  <select id="filterUser">
    <option value="all">All User</option>
  </select>

  <button onclick="applyFilter()">Filter</button>
  <button onclick="exportExcel()">Export Excel</button>
  <button onclick="previewPDF()">Preview PDF</button>
</div>

<!-- SUMMARY -->
<div class="summary">
  <div class="box box-blue">
    <h3>Total Task</h3>
    <h2 id="totalTask">0</h2>
  </div>

  <div class="box box-green">
    <canvas id="pieChart"></canvas>
  </div>
</div>

<!-- TABLE -->
<div class="table-container">
<table id="reportTable">
<thead>
<tr>
  <th onclick="sortTable(0)">Tanggal</th>
  <th onclick="sortTable(1)">User</th>
  <th onclick="sortTable(2)">Jam</th>
  <th onclick="sortTable(3)">Task</th>
  <th onclick="sortTable(4)">Keterangan</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<script>

let allData = [
  {tanggal:"2026-02-20", user:"Andi", jam:"08:00", task:"Input Data", keterangan:"OK"},
  {tanggal:"2026-02-20", user:"Budi", jam:"09:00", task:"Cek Email", keterangan:"Done"},
  {tanggal:"2026-02-21", user:"Andi", jam:"10:00", task:"Meeting", keterangan:"Client"}
];

let filteredData = [...allData];
let chart;

// INIT USER DROPDOWN
function initUsers(){
  let users = [...new Set(allData.map(d=>d.user))];
  let select = document.getElementById("filterUser");
  users.forEach(u=>{
    let opt = document.createElement("option");
    opt.value=u;
    opt.textContent=u;
    select.appendChild(opt);
  });
}

function applyFilter(){
  let from = document.getElementById("fromDate").value;
  let to = document.getElementById("toDate").value;
  let user = document.getElementById("filterUser").value;

  filteredData = allData.filter(d=>{
    let validDate = true;
    if(from) validDate = d.tanggal >= from;
    if(to) validDate = validDate && d.tanggal <= to;

    let validUser = user==="all" || d.user===user;

    return validDate && validUser;
  });

  renderTable();
  updateSummary();
  updateChart();
}

function renderTable(){
  let tbody = document.querySelector("#reportTable tbody");
  tbody.innerHTML="";
  filteredData.forEach(d=>{
    let row = `<tr>
      <td>${d.tanggal}</td>
      <td>${d.user}</td>
      <td>${d.jam}</td>
      <td>${d.task}</td>
      <td>${d.keterangan}</td>
    </tr>`;
    tbody.innerHTML += row;
  });
}

function updateSummary(){
  document.getElementById("totalTask").innerText = filteredData.length;
}

function updateChart(){
  let userCount = {};
  filteredData.forEach(d=>{
    userCount[d.user] = (userCount[d.user]||0)+1;
  });

  let labels = Object.keys(userCount);
  let data = Object.values(userCount);

  if(chart) chart.destroy();

  chart = new Chart(document.getElementById("pieChart"),{
    type:"doughnut",
    data:{
      labels:labels,
      datasets:[{
        data:data
      }]
    },
    options:{
      responsive:true,
      plugins:{
        legend:{position:"bottom"}
      }
    }
  });
}

function sortTable(n){
  filteredData.sort((a,b)=>{
    let keys=["tanggal","user","jam","task","keterangan"];
    return a[keys[n]].localeCompare(b[keys[n]]);
  });
  renderTable();
}

function exportExcel(){
  let ws = XLSX.utils.json_to_sheet(filteredData);
  let wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"Report");
  XLSX.writeFile(wb,"LaporanTask.xlsx");
}

function previewPDF(){
  const { jsPDF } = window.jspdf;
  let doc = new jsPDF();

  doc.text("Laporan Task",10,10);
  let y=20;
  filteredData.forEach(d=>{
    doc.text(`${d.tanggal} - ${d.user} - ${d.task}`,10,y);
    y+=8;
  });

  doc.output("dataurlnewwindow");
}

function checkNotFilled(){
  let users = [...new Set(allData.map(d=>d.user))];
  alert("Semua user sudah isi task hari ini âœ”");
}

function logout(){
  localStorage.removeItem("loginUser");
  window.location.href="login.html";
}

initUsers();
renderTable();
updateSummary();
updateChart();

</script>
</body>
</html>
